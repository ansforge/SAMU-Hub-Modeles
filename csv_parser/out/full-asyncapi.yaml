asyncapi: 2.5.0
info:
  title: Hub Sante AMQP API
  version: '0.9'
  description: "L'API Hub Sante AMQP permet le partage d'informations entre acteurs\
    \ du monde de la sant\xE9.\n"
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
servers:
  remote:
    url: messaging.hub.esante.gouv.fr:5671
    protocol: amqps
    protocolVersion: 0-9-1
    description: "Instance \"bac \xE0 sable\" du Hub Sante d\xE9ploy\xE9e dans le\
      \ Cloud."
    security:
    - tlsAuth: []
  local:
    url: localhost:5671
    protocol: amqps
    protocolVersion: 0-9-1
    description: "Instance locale du Hub Sante port\xE9e par `minikube` dans le repo\
      \ du Hub"
    security:
    - tlsAuth: []
defaultContentType: application/json
channels:
  '{clientId}.message':
    description: "File sp\xE9cifique \xE0 chaque client pour la r\xE9ception de messages"
    parameters:
      clientId:
        $ref: '#/components/parameters/clientId'
    subscribe:
      summary: Message fonctionnel
      operationId: receiveMessage
      message:
        $ref: '#/components/messages/edxlMessage'
    publish:
      summary: Message fonctionnel
      operationId: publishMessage
      message:
        $ref: '#/components/messages/edxlMessage'
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: hubsante
          type: topic
          durable: true
          autoDelete: false
          vhost: /
  '{clientId}.ack':
    description: "File sp\xE9cifique \xE0 chaque client pour la r\xE9ception des acquittements\
      \ de bonne r\xE9ception"
    parameters:
      clientId:
        $ref: '#/components/parameters/clientId'
    subscribe:
      summary: Acquittement fonctionnel
      operationId: receiveAck
      message:
        $ref: '#/components/messages/edxlMessage'
    publish:
      summary: "Acquittements de bonne r\xE9ception"
      operationId: publishAck
      message:
        $ref: '#/components/messages/edxlMessage'
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: hubsante
          type: topic
          durable: true
          autoDelete: false
          vhost: /
  '{clientId}.info':
    description: "File sp\xE9cifique \xE0 chaque client pour la r\xE9ception des informations\
      \ compl\xE9mentaires li\xE9es au fonctionnement et aux \xE9changes port\xE9\
      s par le Hub Sant\xE9"
    parameters:
      clientId:
        $ref: '#/components/parameters/clientId'
    subscribe:
      summary: "Informations compl\xE9mentaires"
      operationId: receiveInfo
      message:
        $ref: '#/components/messages/edxlMessage'
    publish:
      summary: "Informations compl\xE9mentaires"
      operationId: publishInfo
      message:
        $ref: '#/components/messages/edxlMessage'
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: hubsante
          type: topic
          durable: true
          autoDelete: false
          vhost: /
components:
  securitySchemes:
    tlsAuth:
      type: X509
      description: "Un certificat issu d'une AC valid\xE9e par le Hub est n\xE9cessaire\
        \ pour l'authentification mTLS"
  parameters:
    clientId:
      description: L'identifiant du client
      schema:
        type: string
  messages:
    edxlMessage:
      title: Message au standard EDXL
      summary: "Message au standard EDXL transportable par le Hub, comportant une\
        \ partie adressage et une partie contenu. La partie contenu peut respecter\
        \ diff\xE9rentes sp\xE9cifications fonctionnelles."
      payload:
        $ref: '#/components/schemas/EdxlMessage'
  schemas:
    EdxlMessage:
      properties:
        distributionID:
          type: string
        senderID:
          type: string
        dateTimeSent:
          type: string
          format: date-time
        dateTimeExpires:
          type: string
          format: date-time
        distributionStatus:
          $ref: '#/components/schemas/DistributionStatus'
        distributionKind:
          $ref: '#/components/schemas/DistributionKind'
        descriptor:
          $ref: '#/components/schemas/Descriptor'
        content:
          $ref: '#/components/schemas/Content'
      additionalProperties: false
      required:
      - distributionID
      - senderID
      - dateTimeSent
      - dateTimeExpires
      - distributionStatus
      - distributionKind
      - descriptor
      - content
    Content:
      properties:
        contentObject:
          $ref: '#/components/schemas/ContentObject'
      additionalProperties: false
      required:
      - contentObject
    ContentObject:
      oneOf:
      - $ref: '#/components/schemas/JsonContent'
      - $ref: '#/components/schemas/ContentXML'
    JsonContent:
      properties:
        JsonContent:
          $ref: '#/components/schemas/EmbeddedJsonContent'
    ContentXML:
      properties:
        contentXML:
          $ref: '#/components/schemas/EmbeddedXMLContent'
    EmbeddedJsonContent:
      oneOf: null
    EmbeddedXMLContent:
      oneOf: null
    Descriptor:
      properties:
        language:
          type: string
        explicitAddress:
          $ref: '#/components/schemas/ExplicitAddress'
      additionalProperties: false
      required:
      - language
      - explicitAddress
    ExplicitAddress:
      properties:
        explicitAddressScheme:
          type: string
        explicitAddressValue:
          type: string
      additionalProperties: false
      required:
      - explicitAddressScheme
      - explicitAddressValue
    DistributionKind:
      type: string
      enum:
      - Report
      - Update
      - Cancel
      - Request
      - Response
      - Dispatch
      - Ack
      - Error
      - SensorConfiguration
      - SensorControl
      - SensorStatus
      - SensorDetection
      - Unknown
      - NoAppropriateDefault
    DistributionStatus:
      type: string
      enum:
      - Actual
      - Exercise
      - System
      - Test
      - Unknown
      - NoAppropriateDefault
    DistributionElement:
      type: object
      title: DistributionElement
      required:
      - messageId
      - sender
      - sentAt
      - kind
      - status
      - recipients
      properties:
        messageId:
          type: string
        sender:
          $ref: '#/components/schemas/sender'
        sentAt:
          type: string
          pattern: \d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}[\-+]\d{2}:\d{2}
          format: date-time
        kind:
          type: string
          enum:
          - Report
          - Update
          - Cancel
          - Ack
          - Error
        status:
          type: string
          enum:
          - Actual
          - Exercise
          - System
        recipients:
          type: array
          items:
            $ref: '#/components/schemas/recipient'
          minItems: 1
    sender:
      type: object
      required:
      - name
      - URI
      properties:
        name:
          type: string
        URI:
          type: string
    recipient:
      type: object
      required:
      - name
      - URI
      properties:
        name:
          type: string
        URI:
          type: string
    ReferenceWrapper:
      required:
      - Reference
      properties:
        reference:
          $ref: '#/components/schemas/Reference'
    Reference:
      properties:
        distributionID:
          type: string
      required:
      - distributionID
    emsiWrapper:
      $id: classpath:/json-schema/schema#
      x-id: EMSI.schema.json#
      example: example.json#
      type: object
      title: emsi
      required:
      - emsi
      properties:
        emsi:
          $ref: '#/components/schemas/emsi'
          x-health-only: false
    emsi:
      type: object
      title: Objet emsi
      x-display: expansion-panels
      x-health-only: false
      required: []
      properties:
        RESOURCE:
          type: array
          items:
            $ref: '#/components/schemas/resource'
            x-health-only: true
      example: example.json#/emsi
    resource:
      type: object
      title: Ressource
      x-display: expansion-panels
      x-health-only: true
      required:
      - RTYPE
      properties:
        RTYPE:
          $ref: '#/components/schemas/rtype'
          x-health-only: true
        ID:
          type: string
          title: ID de la ressource
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/ID
          description: "Identifiant unique de la ressource  dans le syst\xE8me du\
            \ partenaire propri\xE9taire. Les syst\xE8mes sont garants de l'unicit\xE9\
            \ et de l'invariablit\xE9 des ids de v\xE9hicule dans le temps. Ils peuvent\
            \ se servir des ids dans les r\xE9f\xE9rentiels existants si ils sont\
            \ uniques et stables.\nDans le cas d'un v\xE9hicule agr\xE9g\xE9 par un\
            \ LRM (comme un SMUR), l'ID doit \xEAtre valoris\xE9 avec son immatriculation.\n\
            Dans le cas d'un v\xE9hicule agr\xE9g\xE9 par NexSIS, l'ID fournit peut\
            \ ne pas correspondre \xE0 une immatriculation."
          examples:
          - 77_45102#VSAV 1#
        ORG_ID:
          type: string
          title: "Identifiant de l'organisation propri\xE9taire"
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/ORG_ID
          description: "Identifiant de l'organisation \xE0 laquelle la ressource est\
            \ rattach\xE9e (caserne, SAMU etc).\nSe r\xE9f\xE9rer au DSF pour la structure\
            \ norm\xE9e des organisations\nLe format est le suivant {pays}.{domaine}.{code\
            \ d\xE9partement}.{organisation}.{structure interne}*.{unit\xE9 fonctionnelle}*.\n\
            Dans le cas o\xF9 le LRM/NexSIS sert d'aggr\xE9gateur pour des v\xE9hicules\
            \ appartenant \xE0 un partenaire tiers (type ambulance priv\xE9e), l'identifiant\
            \ d'organisation permet d'identifier ce tiers\nA constituer par le r\xE9\
            dacteur du pr\xE9sent EMSI pour \xEAtre unique, identique \xE0 <CONTEXT><ORIGIN><ORG_ID>"
          examples:
          - FR:Administration:44:CASERNENANTES
        NAME:
          type: string
          title: Nom de la ressource
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/NAME
          description: "Nom donn\xE9 \xE0 la ressource par le partenaire. L'immatriculation\
            \ peut \xEAtre utilis\xE9e dans le nom courant des v\xE9hicules.\nDans\
            \ le cas pompier, les v\xE9hicules sont nomm\xE9s\nDans le cas d'\xE9\
            quipier, cela peut \xEAtre leur nom"
          examples:
          - VSAV 1 Nantes
        FREETEXT:
          type: string
          title: Description de la ressource
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/FREETEXT
          description: "Texte libre permettant de d\xE9crire la ressource o\xF9 d'ajouter\
            \ des pr\xE9cisions sur son engagement.\nPermet aussi notamment de d\xE9\
            crire des attributs librement pour la ressource.\nPar exemple, pour un\
            \ v\xE9hicule, sa plaque d'immatriculation."
          examples:
          - None
        RGEO:
          type: array
          items:
            $ref: '#/components/schemas/rgeo'
            x-health-only: true
        QUANTITY:
          type: number
          title: "Quantit\xE9 de la ressource"
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/QUANTITY
          description: "Dans le cadre d'un \xE9change d'op\xE9ration, optionnel. Permet\
            \ de quantifier une ressource :\n- \xE0 ne pas utiliser pour les v\xE9\
            hicules ni le personnel\n- utilisable pour du mat\xE9riel\n- utilisable\
            \ pour des consommables (dans le cas de consommable, \xE0 compl\xE9ter\
            \ avec le champ UM)"
          examples:
          - 1
        UM:
          type: string
          title: "Unit\xE9 de mesure pour la ressource"
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/UM
          description: "Dans le cadre d'un \xE9change d'op\xE9ration, optionnel. Unit\xE9\
            \ de mesure pour des ressources consommables"
          examples:
          - None
        STATUS:
          type: string
          title: Statut de la ressource
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/STATUS
          description: "D\xE9finit le statut de disponibilit\xE9 d'une ressource.\n\
            - AVAILB : Lorsqu'une mission est termin\xE9e, une ressource redevient\
            \ disponible\n- RESRVD : Lorsque la ressource est r\xE9serv\xE9e pour\
            \ intervenir sur l'affaire mais pas encore engag\xE9e dans l'op\xE9ration.\
            \ Par exemple : un SMUR termine un autre transfert patient/victime avant\
            \ de rejoindre une autre intervention : il est alors RESRVD\n- IN_USE/MOBILE\
            \ : \xE0 utiliser pour les v\xE9hicules et le personnel lorsqu'ils se\
            \ d\xE9places\n- IN_USE/ON_SCENE : \xE0 utiliser pour les v\xE9hicules\
            \ et le personnel lorsqu'ils sont sur les lieux de l'affaire"
          examples:
          - IN_USE/MOBILE
        NATIONALITY:
          type: string
          title: "Nationalit\xE9 de la ressource"
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/NATIONALITY
          description: "Nationalit\xE9 d'une ressource, r\xE9employer ISO 3166-1-alpha-2\
            \ code elements."
          examples:
          - FR
        CONTACTS:
          type: array
          items:
            $ref: '#/components/schemas/contact'
            x-health-only: true
      example: example.json#/emsi/RESOURCE/0
    rtype:
      type: object
      title: Type de la ressource
      x-display: expansion-panels
      x-health-only: true
      required:
      - RCLASS
      properties:
        RCLASS:
          type: array
          x-health-only: true
          items:
            type: string
            title: Classes de la ressource
            x-health-only: true
            x-cols: 6
            example: example.json#/emsi/RESOURCE/0/RTYPE/RCLASS/0
            description: "Permet d'indiquer la classe de l'objet RESOURCE. Plusieurs\
              \ niveau de d\xE9tails sont fournis par la nomenclature associ\xE9e.\n\
              Le premier niveau permet notamment de d\xE9crire la classe principale\
              \ de ressource :\n- Un v\xE9hicule,\n- Le personnel mobilis\xE9,\n-\
              \ Des consommables/ du mat\xE9riel,\n- Un lieu ou une organisation (non\
              \ utilis\xE9 pour le moment)\nVoir nomenclature EMSI associ\xE9e"
            examples:
            - MAT/VEH/ROADVE/FRFGTN
        CAPABILITY:
          type: array
          x-health-only: true
          items:
            type: string
            title: "Capacit\xE9s de la ressource"
            x-health-only: true
            x-cols: 6
            example: example.json#/emsi/RESOURCE/0/RTYPE/CAPABILITY/0
            description: "Permet d'indiquer les capacit\xE9s de la ressource d'apr\xE8\
              s le standard EMSI"
            examples:
            - None
        CHARACTERISTICS:
          type: array
          x-health-only: true
          items:
            type: string
            title: "Caract\xE9ristiques de la ressource"
            x-health-only: true
            x-cols: 6
            example: example.json#/emsi/RESOURCE/0/RTYPE/CHARACTERISTICS/0
            description: "Permet d'indiquer des caract\xE9ristique physiques de la\
              \ ressource (hauteur, largeur, longueur et poids).\nLe d\xE9tail de\
              \ fonctionnement de cette nomenclature est fournie en annexe."
            examples:
            - None
      example: example.json#/emsi/RESOURCE/0/RTYPE
    rgeo:
      type: object
      title: Localisation de la ressource
      x-display: expansion-panels
      x-health-only: true
      required:
      - TYPE
      properties:
        DATIME:
          type: string
          title: Horaire de la localisation
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/RGEO/0/DATIME
          description: "Horaire associ\xE9 \xE0 l'arriv\xE9e de la ressource sur la\
            \ position. En fonction du TYPE de possition, peut indiquer un horaire\
            \ de relev\xE9 de position, un horaire cible d'arriv\xE9e."
          pattern: \d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}[\-+]\d{2}:\d{2}
          format: date-time
          examples:
          - '2022-09-27T08:44:00+02:00'
        TYPE:
          type: string
          title: Type de localisation
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/RGEO/0/TYPE
          description: "Type de position indiqu\xE9 pour la ressource :\n- ASP : assembly\
            \ point. Point de rassemblement par d\xE9faut des ressources li\xE9es\
            \ \xE0 la mission. Peut ne pas \xEAtre utilis\xE9\n- CUR : current. Position\
            \ actualis\xE9e de la ressource permettant le suivi g\xE9olocalis\xE9\
            \ des v\xE9hicules notamment. Peut ne pas \xEAtre utilis\xE9\n- INC :\
            \ incident. Consigne relative au positionnement de la ressource sur le\
            \ lieu d'intervention. Peut ne pas \xEAtre utilis\xE9\n- STG : staging\
            \ point. Consigne relative au stationnement des v\xE9hicules ou au stockage\
            \ du mat\xE9riel par exemple. peut ne pas \xEAtre utilis\xE9\n- TGT :\
            \ targer location. Si renseign\xE9, doit \xEAtre coh\xE9rent avec la position\
            \ renseign\xE9e pour la mission.\nPlusieurs positions du m\xEAme type\
            \ avec des horodatages diff\xE9rents peuvent \xEAtre fournies. "
          examples:
          - CUR
        FREETEXT:
          type: string
          title: 'Texte libre '
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/RGEO/0/FREETEXT
          description: "Permet de rajouter des pr\xE9cisions sur la localisation de\
            \ la ressource transmise"
          examples:
          - "Position actualis\xE9e du VSAV 1 Nantes"
        ID:
          type: string
          title: ID localisation
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/RGEO/0/ID
          description: "Identifiant unique de la position dans le syst\xE8me du partenaire"
          examples:
          - None
        POSITION:
          type: array
          items:
            $ref: '#/components/schemas/position'
            x-health-only: true
      example: example.json#/emsi/RESOURCE/0/RGEO/0
    contact:
      type: object
      title: Contacts
      x-display: expansion-panels
      x-health-only: true
      required:
      - TYPE
      - DETAIL
      properties:
        TYPE:
          type: string
          title: Type de contact
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/CONTACTS/0/TYPE
          description: "Type de contact, voir \xE9num\xE9ration associ\xE9e\n\n1.\
            \ PMRADD (si RFGI disponible)\n2. PHNADD pour t\xE9l\xE9phonie"
          examples:
          - PHNADD
        DETAIL:
          type: string
          title: "D\xE9tails de contact"
          x-health-only: true
          x-cols: 6
          example: example.json#/emsi/RESOURCE/0/CONTACTS/0/DETAIL
          description: "1. RFGI du moyen NEXSIS (si RFGI disponible)\n2. Num\xE9ro\
            \ de t\xE9l\xE9phone"
          examples:
          - 606070707
      example: example.json#/emsi/RESOURCE/0/CONTACTS/0
      examples:
      - TYPE: PHNADD
        DETAIL: 606070707
    position:
      type: object
      title: "Position g\xE9ographique"
      x-display: expansion-panels
      x-health-only: true
      required: []
      properties: {}
      example: example.json#/emsi/RESOURCE/0/RGEO/0/POSITION/0
      examples:
      - {}
