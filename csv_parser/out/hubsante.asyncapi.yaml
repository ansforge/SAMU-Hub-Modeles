asyncapi: 3.0.0
info:
  title: "Hub Sant\xE9 - Mod\xE8les"
  version: '1.0'
  description: "Le Hub Sant\xE9 permet le partage d'informations entre acteurs du\
    \ monde de la Sant\xE9.\n"
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
defaultContentType: application/json
servers:
  bac-a-sable:
    host: messaging.bac-a-sable.hub.esante.gouv.fr:5671
    protocol: amqps
    protocolVersion: 0-9-1
    description: "Instance \"bac \xE0 sable\" du Hub Sante d\xE9ploy\xE9e dans le\
      \ Cloud."
    security:
    - $ref: '#/components/securitySchemes/tlsAuthIGCTest'
  pre-prod:
    host: messaging.pre-prod.hub.esante.gouv.fr:5671
    protocol: amqps
    protocolVersion: 0-9-1
    description: "Instance \"pr\xE9-prod\" du Hub Sante d\xE9ploy\xE9e dans le Cloud."
    security:
    - $ref: '#/components/securitySchemes/tlsAuthIGC'
  prod:
    host: messaging.hub.esante.gouv.fr:5671
    protocol: amqps
    protocolVersion: 0-9-1
    description: "Instance de production du Hub Sante d\xE9ploy\xE9e dans le Cloud."
    security:
    - $ref: '#/components/securitySchemes/tlsAuthIGC'
channels:
  '{clientId}':
    address: '{clientId}'
    messages:
      edxlMessage:
        $ref: '#/components/messages/edxlMessage'
    description: "Exchange d'entr\xE9e avec un topic sp\xE9cifique \xE0 chaque client\
      \ (routingKey \xE9gale \xE0 son clientId) pour l'envoi de tous les messages"
    parameters:
      clientId:
        $ref: '#/components/parameters/clientId'
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: hubsante
          type: topic
          durable: true
          autoDelete: false
          vhost: /
  '{clientId}.message':
    address: '{clientId}.message'
    messages:
      edxlMessage:
        $ref: '#/components/messages/edxlMessage'
    description: "File sp\xE9cifique \xE0 chaque client pour la r\xE9ception de messages\
      \ fonctionnels"
    parameters:
      clientId:
        $ref: '#/components/parameters/clientId'
    bindings:
      amqp:
        is: queue
        queue:
          name: '{clientId}.message'
          durable: true
          exclusive: false
          autoDelete: false
          vhost: /
  '{clientId}.ack':
    address: '{clientId}.ack'
    messages:
      edxlMessage:
        $ref: '#/components/messages/edxlMessage'
    description: "File sp\xE9cifique \xE0 chaque client pour la r\xE9ception des acquittements\
      \ de r\xE9ception finale"
    parameters:
      clientId:
        $ref: '#/components/parameters/clientId'
    bindings:
      amqp:
        is: queue
        queue:
          name: '{clientId}.ack'
          durable: true
          exclusive: false
          autoDelete: false
          vhost: /
  '{clientId}.info':
    address: '{clientId}.info'
    messages:
      edxlMessage:
        $ref: '#/components/messages/edxlMessage'
    description: "File sp\xE9cifique \xE0 chaque client pour la r\xE9ception des informations\
      \ et erreurs compl\xE9mentaires li\xE9es au fonctionnement et aux \xE9changes\
      \ port\xE9s par le Hub Sant\xE9"
    parameters:
      clientId:
        $ref: '#/components/parameters/clientId'
    bindings:
      amqp:
        is: queue
        queue:
          name: '{clientId}.info'
          durable: true
          exclusive: false
          autoDelete: false
          vhost: /
operations:
  publish:
    title: Publication
    summary: "Publication de tous les types de messages sur le Hub Sant\xE9"
    action: send
    channel:
      $ref: '#/channels/{clientId}'
    messages:
    - $ref: '#/channels/{clientId}/messages/edxlMessage'
    bindings:
      amqp:
        expiration: 86400000
        userId: '{clientId}'
        cc:
        - '{clientId}'
        deliveryMode: 2
        mandatory: true
        ack: true
  receiveMessage:
    title: "R\xE9ception de messages fonctionnels"
    action: receive
    channel:
      $ref: '#/channels/{clientId}.message'
    messages:
    - $ref: '#/channels/{clientId}.message/messages/edxlMessage'
    bindings:
      amqp:
        expiration: 86400000
        userId: '{otherClientId}'
        cc:
        - '{otherClientId}'
        deliveryMode: 2
        mandatory: true
        ack: true
  receiveAck:
    title: "R\xE9ception de messages d'acquittement de r\xE9ception finale"
    action: receive
    channel:
      $ref: '#/channels/{clientId}.ack'
    messages:
    - $ref: '#/channels/{clientId}.ack/messages/edxlMessage'
    bindings:
      amqp:
        expiration: 86400000
        userId: '{otherClientId}'
        cc:
        - '{otherClientId}'
        deliveryMode: 2
        mandatory: true
        ack: true
  receiveInfo:
    title: "R\xE9ception de messages d'info"
    action: receive
    channel:
      $ref: '#/channels/{clientId}.info'
    messages:
    - $ref: '#/channels/{clientId}.info/messages/edxlMessage'
    bindings:
      amqp:
        expiration: 86400000
        userId: '{otherClientId}'
        cc:
        - '{otherClientId}'
        deliveryMode: 2
        mandatory: true
        ack: true
components:
  securitySchemes:
    tlsAuthIGC:
      type: X509
      description: "Un certificat SSL_SERV sign\xE9 par l'IGC Sant\xE9 PROD est n\xE9\
        cessaire pour l'authentification mTLS"
    tlsAuthIGCTest:
      type: X509
      description: "Un certificat SSL_SERV sign\xE9 par l'IGC Sant\xE9 TEST est n\xE9\
        cessaire pour l'authentification mTLS"
  parameters:
    clientId:
      description: L'identifiant du client
    otherClientId:
      description: "L'identifiant d'un autre client du Hub Sant\xE9"
  messages:
    edxlMessage:
      title: Message au standard EDXL
      summary: "Message au standard EDXL transportable par le Hub, comportant une\
        \ partie adressage et une partie contenu. La partie contenu peut respecter\
        \ diff\xE9rentes sp\xE9cifications fonctionnelles."
      headers:
        type: object
        properties:
          correlationId:
            description: Correlation ID set by application
            type: string
          applicationInstanceId:
            description: Unique identifier for a given instance of the publishing
              application
            type: string
      payload:
        $ref: '#/components/schemas/EdxlMessage'
  schemas:
    EdxlMessage:
      properties:
        distributionID:
          type: string
        senderID:
          type: string
        dateTimeSent:
          type: string
          format: date-time
        dateTimeExpires:
          type: string
          format: date-time
        distributionStatus:
          $ref: '#/components/schemas/DistributionStatus'
        distributionKind:
          $ref: '#/components/schemas/DistributionKind'
        descriptor:
          $ref: '#/components/schemas/Descriptor'
        content:
          $ref: '#/components/schemas/Content'
      additionalProperties: false
      required:
      - distributionID
      - senderID
      - dateTimeSent
      - dateTimeExpires
      - distributionStatus
      - distributionKind
      - descriptor
      - content
    DistributionStatus:
      type: string
      enum:
      - Actual
      - Exercise
      - System
      - Test
      - Unknown
      - NoAppropriateDefault
    DistributionKind:
      type: string
      enum:
      - Report
      - Update
      - Cancel
      - Request
      - Response
      - Dispatch
      - Ack
      - Error
      - SensorConfiguration
      - SensorControl
      - SensorStatus
      - SensorDetection
      - Unknown
      - NoAppropriateDefault
    Descriptor:
      properties:
        language:
          type: string
        explicitAddress:
          $ref: '#/components/schemas/ExplicitAddress'
      additionalProperties: false
      required:
      - language
      - explicitAddress
    ExplicitAddress:
      properties:
        explicitAddressScheme:
          type: string
        explicitAddressValue:
          type: string
      additionalProperties: false
      required:
      - explicitAddressScheme
      - explicitAddressValue
    Content:
      properties:
        contentObject:
          $ref: '#/components/schemas/ContentObject'
      additionalProperties: false
      required:
      - contentObject
    ContentObject:
      oneOf:
      - $ref: '#/components/schemas/JsonContent'
      - $ref: '#/components/schemas/ContentXML'
    JsonContent:
      properties:
        JsonContent:
          $ref: '#/components/schemas/EmbeddedJsonContent'
    ContentXML:
      properties:
        contentXML:
          $ref: '#/components/schemas/EmbeddedXMLContent'
    EmbeddedJsonContent:
      oneOf: &id001
      - $ref: '#/components/schemas/technical'
      - $ref: '#/components/schemas/technicalNoreq'
    EmbeddedXMLContent:
      oneOf: *id001
    DistributionElement:
      type: object
      title: DistributionElement
      required:
      - messageId
      - sender
      - sentAt
      - kind
      - status
      - recipients
      properties:
        messageId:
          type: string
        sender:
          $ref: '#/components/schemas/sender'
        sentAt:
          type: string
          pattern: \d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}[\-+]\d{2}:\d{2}
          format: date-time
        kind:
          type: string
          enum:
          - Report
          - Update
          - Cancel
          - Ack
          - Error
        status:
          type: string
          enum:
          - Actual
          - Exercise
          - System
        recipients:
          type: array
          items:
            $ref: '#/components/schemas/recipient'
          minItems: 1
    sender:
      type: object
      required:
      - name
      - URI
      properties:
        name:
          type: string
        URI:
          type: string
    recipient:
      type: object
      required:
      - name
      - URI
      properties:
        name:
          type: string
        URI:
          type: string
    technical:
      $id: classpath:/json-schema/schema#
      x-id: TECHNICAL.schema.json#
      example: example.json#
      type: object
      title: technical
      required:
      - requiredStringField
      - requiredArray
      properties:
        requiredStringField:
          type: string
          title: Required string
          x-health-only: false
          x-cols: 6
          example: example.json#/requiredStringField
          description: This field is required
          examples:
          - None
        optionalStringField:
          type: string
          title: Optional string
          x-health-only: false
          x-cols: 6
          example: example.json#/optionalStringField
          description: This field is optional
          examples:
          - None
        enumerationField:
          type: string
          title: Enumeration
          x-health-only: false
          x-cols: 6
          example: example.json#/enumerationField
          description: This is an enumeration
          enum:
          - ENUM_VALUE_1
          - ENUM_VALUE_2
          - ENUM_VALUE_3
          - ENUM_VALUE_4
          - ENUM_VALUE_5
          examples:
          - None
        integerField:
          type: integer
          title: Optional integer
          x-health-only: false
          x-cols: 6
          example: example.json#/integerField
          description: This is an integer
          examples:
          - None
        numberField:
          type: number
          title: Optional number
          x-health-only: false
          x-cols: 6
          example: example.json#/numberField
          description: This is a number
          examples:
          - None
        booleanField:
          type: boolean
          title: Optional boolean
          x-health-only: false
          x-cols: 6
          example: example.json#/booleanField
          description: This is a boolean
          examples:
          - None
        objectField:
          $ref: '#/components/schemas/technicalObject'
        arrayField:
          type: array
          x-health-only: false
          items:
            type: string
            title: Array
            x-health-only: false
            x-cols: 6
            example: example.json#/arrayField/0
            description: This is an array
            examples:
            - None
        enumArrayField:
          type: array
          x-health-only: false
          items:
            type: string
            title: Array of enumerations
            x-health-only: false
            x-cols: 6
            example: example.json#/enumArrayField/0
            description: This is an array of enumerations
            enum:
            - ENUM_VALUE_10
            - ENUM_VALUE_20
            - ENUM_VALUE_30
            - ENUM_VALUE_40
            - ENUM_VALUE_50
            examples:
            - None
        requiredArray:
          type: array
          x-health-only: false
          items:
            type: string
            title: Required array
            x-health-only: false
            x-cols: 6
            example: example.json#/requiredArray/0
            description: This array is required
            examples:
            - None
          minItems: 1
        arrayWithMaxLength:
          type: array
          x-health-only: false
          items:
            type: string
            title: Array with maximum length
            x-health-only: false
            x-cols: 6
            example: example.json#/arrayWithMaxLength/0
            description: This is an array with a maximum length
            examples:
            - None
          maxItems: 5
        phoneNumberField:
          type: string
          title: Phone number with regex
          x-health-only: false
          x-cols: 6
          example: example.json#/phoneNumberField
          description: Phone number with regex
          pattern: ^\+?[0-9]{2,14}$
          examples:
          - None
        dateField:
          type: string
          title: Date
          x-health-only: false
          x-cols: 6
          example: example.json#/dateField
          description: Date
          pattern: ^\d{4}-\d{2}-\d{2}$
          examples:
          - None
        emailField:
          type: string
          title: Email with regex
          x-health-only: false
          x-cols: 6
          example: example.json#/emailField
          description: Email with regex
          pattern: ^[a-zA-Z0-9_.-]+@([a-zA-Z0-9_-]+\.)+[a-zA-Z0-9_-]{2,4}$
          examples:
          - None
        datetimeField:
          type: string
          title: Datetime
          x-health-only: false
          x-cols: 6
          example: example.json#/datetimeField
          description: Datetime
          pattern: ^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}[\-+]\d{2}:\d{2}$
          format: date-time
          examples:
          - None
        objectLevel1:
          $ref: '#/components/schemas/levelOneData'
        nomenclatureField:
          type: string
          title: Nomenclature
          x-health-only: false
          x-cols: 6
          example: example.json#/nomenclatureField
          description: Enum from extenal nomenclature file
          enum:
          - M
          - F
          - O
          - UN
          examples:
          - None
      additionalProperties: false
    technicalObject:
      type: object
      title: Object
      x-display: expansion-panels
      x-health-only: false
      required:
      - objectPropertyRequiredString
      properties:
        objectPropertyString:
          type: string
          title: Object property A
          x-health-only: false
          x-cols: 6
          example: example.json#/objectField/objectPropertyString
          description: Object property string
          examples:
          - None
        objectPropertyNumber:
          type: number
          title: Object property B
          x-health-only: false
          x-cols: 6
          example: example.json#/objectField/objectPropertyNumber
          description: Object property number
          examples:
          - None
        objectPropertyRequiredString:
          type: string
          title: Required Object Property
          x-health-only: false
          x-cols: 6
          example: example.json#/objectField/objectPropertyRequiredString
          description: Required object property
          examples:
          - None
      additionalProperties: false
      example: example.json#/objectField
      examples:
      - objectPropertyString: None
        objectPropertyNumber: None
        objectPropertyRequiredString: None
    levelOneData:
      type: object
      title: Level 1 Object
      x-display: expansion-panels
      x-health-only: false
      required: []
      properties:
        object1Level2:
          $ref: '#/components/schemas/levelTwoData'
        stringLevel2:
          type: string
          title: Level 2 Field
          x-health-only: false
          x-cols: 6
          example: example.json#/objectLevel1/stringLevel2
          description: String field at level 2
          examples:
          - None
        object2Level2:
          $ref: '#/components/schemas/secondLevelTwoData'
      additionalProperties: false
      example: example.json#/objectLevel1
    levelTwoData:
      type: object
      title: Level 2 Object 1
      x-display: expansion-panels
      x-health-only: false
      required: []
      properties:
        object1Level3:
          $ref: '#/components/schemas/levelThreeData'
        stringLevel3:
          type: string
          title: Level 3 Field
          x-health-only: false
          x-cols: 6
          example: example.json#/objectLevel1/object1Level2/stringLevel3
          description: String field at level 3
          examples:
          - None
      additionalProperties: false
      example: example.json#/objectLevel1/object1Level2
    secondLevelTwoData:
      type: object
      title: Level 2 Object 2
      x-display: expansion-panels
      x-health-only: false
      required: []
      properties:
        object2Level3:
          $ref: '#/components/schemas/levelThreeData'
      additionalProperties: false
      example: example.json#/objectLevel1/object2Level2
      examples:
      - object2Level3: {}
    levelThreeData:
      type: object
      title: Level 3 Object 1
      x-display: expansion-panels
      x-health-only: false
      required: []
      properties:
        stringLevel4:
          type: string
          title: Level 4 Field
          x-health-only: false
          x-cols: 6
          example: example.json#/objectLevel1/object1Level2/object1Level3/stringLevel4
          description: String field at level 4
          examples:
          - None
      additionalProperties: false
      example: example.json#/objectLevel1/object1Level2/object1Level3
      examples:
      - stringLevel4: None
    technicalNoreq:
      $id: classpath:/json-schema/schema#
      x-id: TECHNICAL_NOREQ.schema.json#
      example: example.json#
      type: object
      title: technicalNoreq
      required: []
      properties:
        optionalStringField:
          type: string
          title: Optional string
          x-health-only: false
          x-cols: 6
          example: example.json#/optionalStringField
          description: This field is optional
          examples:
          - None
        enumerationField:
          type: string
          title: Enumeration
          x-health-only: false
          x-cols: 6
          example: example.json#/enumerationField
          description: This is an enumeration
          enum:
          - ENUM_VALUE_1
          - ENUM_VALUE_2
          - ENUM_VALUE_3
          - ENUM_VALUE_4
          - ENUM_VALUE_5
          examples:
          - None
        integerField:
          type: integer
          title: Optional integer
          x-health-only: false
          x-cols: 6
          example: example.json#/integerField
          description: This is an integer
          examples:
          - None
        numberField:
          type: number
          title: Optional number
          x-health-only: false
          x-cols: 6
          example: example.json#/numberField
          description: This is a number
          examples:
          - None
        booleanField:
          type: boolean
          title: Optional boolean
          x-health-only: false
          x-cols: 6
          example: example.json#/booleanField
          description: This is a boolean
          examples:
          - None
        objectField:
          $ref: '#/components/schemas/technicalObject'
        arrayField:
          type: array
          x-health-only: false
          items:
            type: string
            title: Array
            x-health-only: false
            x-cols: 6
            example: example.json#/arrayField/0
            description: This is an array
            examples:
            - None
        enumArrayField:
          type: array
          x-health-only: false
          items:
            type: string
            title: Array of enumerations
            x-health-only: false
            x-cols: 6
            example: example.json#/enumArrayField/0
            description: This is an array of enumerations
            enum:
            - ENUM_VALUE_10
            - ENUM_VALUE_20
            - ENUM_VALUE_30
            - ENUM_VALUE_40
            - ENUM_VALUE_50
            examples:
            - None
        arrayWithMaxLength:
          type: array
          x-health-only: false
          items:
            type: string
            title: Array with maximum length
            x-health-only: false
            x-cols: 6
            example: example.json#/arrayWithMaxLength/0
            description: This is an array with a maximum length
            examples:
            - None
          maxItems: 5
        phoneNumberField:
          type: string
          title: Phone number with regex
          x-health-only: false
          x-cols: 6
          example: example.json#/phoneNumberField
          description: Phone number with regex
          pattern: ^\+?[0-9]{2,14}$
          examples:
          - None
        dateField:
          type: string
          title: Date
          x-health-only: false
          x-cols: 6
          example: example.json#/dateField
          description: Date
          pattern: ^\d{4}-\d{2}-\d{2}$
          examples:
          - None
        emailField:
          type: string
          title: Email with regex
          x-health-only: false
          x-cols: 6
          example: example.json#/emailField
          description: Email with regex
          pattern: ^[a-zA-Z0-9_.-]+@([a-zA-Z0-9_-]+\.)+[a-zA-Z0-9_-]{2,4}$
          examples:
          - None
        datetimeField:
          type: string
          title: Datetime
          x-health-only: false
          x-cols: 6
          example: example.json#/datetimeField
          description: Datetime
          pattern: ^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}[\-+]\d{2}:\d{2}$
          format: date-time
          examples:
          - None
        objectLevel1:
          $ref: '#/components/schemas/levelOneData'
        nomenclatureField:
          type: string
          title: Nomenclature
          x-health-only: false
          x-cols: 6
          example: example.json#/nomenclatureField
          description: Enum from extenal nomenclature file
          enum:
          - M
          - F
          - O
          - UN
          examples:
          - None
      additionalProperties: false
