name: Security Scan

on:
  push:
    branches:
      - main
      - develop
      - chore/security/ci-code-scan
  pull_request:
    branches:
      - main
      - develop
      - chore/security/ci-code-scan
  schedule:
    # Run weekly on Mondays at 3 AM UTC
    - cron: '0 3 * * 1'
  workflow_dispatch:

jobs:
  # Security scan for the main Java library
  security-scan-library:
    uses: ./.github/workflows/security-scan.yml
    with:
      working-directory: '.'
      project-type: 'java'
      java-version: '11'  # Using 11 instead of 8 for better tooling support
      component-name: 'library'
      dependency-scan: true
      static-analysis: true
      secret-scan: true
      scan-dockerfile: false
      exclude-paths: 'converter,csv_parser,nomenclature_parser,web_specs'
    secrets: inherit

  # Security scan for the Python converter
  security-scan-converter:
    uses: ./.github/workflows/security-scan.yml
    with:
      working-directory: 'converter'
      project-type: 'python'
      python-version: '3.9'
      component-name: 'converter'
      dependency-scan: true
      static-analysis: true
      secret-scan: true
      scan-dockerfile: true
    secrets: inherit

  # Security scan for Python CSV parser
  security-scan-csv-parser:
    uses: ./.github/workflows/security-scan.yml
    with:
      working-directory: 'csv_parser'
      project-type: 'python'
      python-version: '3.9'
      component-name: 'csv-parser'
      dependency-scan: true
      static-analysis: true
      secret-scan: true
      scan-dockerfile: false
    secrets: inherit

  # Security scan for Python nomenclature parser
  security-scan-nomenclature-parser:
    uses: ./.github/workflows/security-scan.yml
    with:
      working-directory: 'nomenclature_parser'
      project-type: 'python'
      python-version: '3.9'
      component-name: 'nomenclature-parser'
      dependency-scan: true
      static-analysis: true
      secret-scan: true
      scan-dockerfile: false
    secrets: inherit

  # Security scan for web specs (using Python as it's likely a simple directory)
  security-scan-web-specs:
    uses: ./.github/workflows/security-scan.yml
    with:
      working-directory: 'web_specs'
      project-type: 'none'
      python-version: '3.9'
      component-name: 'web-specs'
      dependency-scan: false  # No package.json or pyproject.toml found
      static-analysis: true
      secret-scan: true
      scan-dockerfile: true
    secrets: inherit